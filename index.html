<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raise a Raddy</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; background: #222; }
        #ui { position: absolute; top: 10px; left: 10px; color: white; pointer-events: none; }
        .bar-container { width: 200px; height: 20px; background: #444; margin-bottom: 5px; border: 2px solid #000; }
        #hunger-bar { width: 100%; height: 100%; background: #4caf50; transition: width 0.3s; }
        #trauma-bar { width: 0%; height: 100%; background: #f44336; transition: width 0.3s; }
        #controls { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; }
        button { padding: 10px 20px; font-weight: bold; cursor: pointer; border-radius: 8px; border: none; }
        .btn-feed { background: #ff9800; }
        .btn-med { background: #2196f3; }
    </style>
</head>
<body>

<div id="ui">
    <div>HUNGER</div>
    <div class="bar-container"><div id="hunger-bar"></div></div>
    <div>TRAUMA</div>
    <div class="bar-container"><div id="trauma-bar"></div></div>
    <p id="status">Raddy is happy!</p>
</div>

<div id="controls">
    <button class="btn-feed" onclick="feed()">GIVE FOOD</button>
    <button class="btn-med" onclick="heal()">GIVE MEDICINE</button>
</div>

<script>
    // --- Configuration ---
    const IMG_HEALTHY = "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR77UDRX0_NR9m-3OOWGBGMVmBUeCLbIWWOy0ygdUSkipoZZKGPe6JtKnM&s";
    const IMG_CORRUPT = "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRUxc_0XdM2OASSik4BbEg3Xe3_yXGNuJVsDGXpfHOYFQ&s=10";

    let hunger = 100;
    let trauma = 0;
    let isCorrupt = false;

    // --- Matter.js Setup ---
    const { Engine, Render, Runner, World, Bodies, MouseConstraint, Mouse, Composite, Events } = Matter;
    const engine = Engine.create();
    const render = Render.create({
        element: document.body,
        engine: engine,
        options: { width: window.innerWidth, height: window.innerHeight, wireframes: false, background: '#87CEEB' }
    });

    // Ground & Walls
    const ground = Bodies.rectangle(window.innerWidth/2, window.innerHeight + 25, window.innerWidth, 50, { isStatic: true });
    const wallL = Bodies.rectangle(-25, window.innerHeight/2, 50, window.innerHeight, { isStatic: true });
    const wallR = Bodies.rectangle(window.innerWidth + 25, window.innerHeight/2, 50, window.innerHeight, { isStatic: true });

    // Raddy Body
    const raddy = Bodies.circle(window.innerWidth/2, 100, 50, {
        restitution: 0.8,
        render: { sprite: { texture: IMG_HEALTHY, xScale: 0.5, yScale: 0.5 } }
    });

    World.add(engine.world, [ground, wallL, wallR, raddy]);

    // Mouse Interaction
    const mouse = Mouse.create(render.canvas);
    const mouseConstraint = MouseConstraint.create(engine, { mouse: mouse });
    World.add(engine.world, mouseConstraint);

    // --- Game Logic ---
    Events.on(engine, 'collisionStart', (event) => {
        event.pairs.forEach((pair) => {
            if (pair.bodyA === raddy || pair.bodyB === raddy) {
                let speed = raddy.speed;
                if (speed > 10) {
                    spawnBlood(raddy.position.x, raddy.position.y);
                    trauma = Math.min(100, trauma + 15);
                }
            }
        });
    });

    function spawnBlood(x, y) {
        const blood = Bodies.circle(x, y, 5, { 
            isSensor: true, 
            render: { fillStyle: 'red' },
            frictionAir: 0.05
        });
        World.add(engine.world, blood);
        
        // Fade and Remove
        let opacity = 1;
        let fadeInterval = setInterval(() => {
            opacity -= 0.05;
            blood.render.opacity = opacity;
            if (opacity <= 0) {
                clearInterval(fadeInterval);
                World.remove(engine.world, blood);
            }
        }, 100);
    }

    function feed() {
        hunger = Math.min(100, hunger + 20);
    }

    function heal() {
        trauma = Math.max(0, trauma - 25);
    }

    // Update Loop
    setInterval(() => {
        // Stats decay
        hunger = Math.max(0, hunger - 0.5);
        if (hunger < 10) trauma += 0.2;

        // Visual Transformation
        if ((trauma >= 80 || hunger <= 0) && !isCorrupt) {
            isCorrupt = true;
            raddy.render.sprite.texture = IMG_CORRUPT;
            document.getElementById('status').innerText = "RADDY IS CORRUPTED!";
        } else if (trauma < 20 && hunger > 50 && isCorrupt) {
            isCorrupt = false;
            raddy.render.sprite.texture = IMG_HEALTHY;
            document.getElementById('status').innerText = "Raddy is healthy again.";
        }

        // Update UI
        document.getElementById('hunger-bar').style.width = hunger + "%";
        document.getElementById('trauma-bar').style.width = trauma + "%";
    }, 100);

    Render.run(render);
    Runner.run(Runner.create(), engine);
</script>
</body>
</html>
